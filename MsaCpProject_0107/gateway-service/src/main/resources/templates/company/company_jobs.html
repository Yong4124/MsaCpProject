<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채용공고관리 - 주한미군 전역장병 채용 플랫폼</title>

    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/sub.css">

    <style>
        .mypage-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* 탭 메뉴 */
        .tab-menu {
            display: flex;
            border-bottom: 3px solid #F0F0F0;
            margin-bottom: 80px;
        }
        .tab-menu a {
            font-size: 24px;
            color: #000;
            font-weight: 700;
            margin-right: 50px;
            position: relative;
            padding-bottom: 8px;
            text-decoration: none;
        }
        .tab-menu a:after {
            content: '';
            display: block;
            width: 100%;
            height: 3px;
            background-color: transparent;
            position: absolute;
            left: 0;
            bottom: -3px;
        }
        .tab-menu a:last-child {
            margin-right: 0;
        }
        .tab-menu a:hover {
            color: #255EB8;
        }
        .tab-menu a.active {
            color: #255EB8;
        }
        .tab-menu a.active:after {
            background-color: #255EB8;
        }

        /* 지원현황 헤더 */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 36px;
            color: #000;
            font-weight: 700;
        }

        /* 검색 영역 - 오른쪽 정렬 */
        .search-area {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .search-area select {
            height: 40px;
            padding: 0 15px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-size: 16px;
            background: #fff;
        }
        .search-area .search-input {
            display: flex;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }
        .search-area .search-input input {
            width: 180px;
            height: 38px;
            padding: 0 15px;
            border: none;
            font-size: 16px;
        }
        .search-area .search-input button {
            width: 40px;
            height: 38px;
            background: #fff;
            border: none;
            border-left: 1px solid #ccc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 공고 목록 */
        .job-list {
            border-top: 3px solid #255EB8;
            border-bottom: 3px solid #255EB8;
        }
        .job-item {
            display: flex;
            padding: 40px 20px;
            border-bottom: 1px dashed #ccc;
            align-items: flex-start;
        }
        .job-item:last-child {
            border-bottom: none;
        }
        .job-logo {
            width: 220px;
            height: 125px;
            border: 1px solid #ccc;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 30px;
            flex-shrink: 0;
            overflow: hidden;
            padding: 10px;
        }
        .job-logo img {
            max-width: 100%;
            max-height: 100%;
        }
        .job-content {
            flex: 1;
        }
        .job-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #000;
        }

        /* 공고 정보 테이블 형식 */
        .job-info-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 13px 40px;
            max-width: 690px;
        }
        .job-info-row {
            display: flex;
            font-size: 18px;
            line-height: 1.6;
        }
        .job-info-row .label {
            color: #000;
            font-weight: 600;
            min-width: 100px;
            margin-right: 15px;
        }
        .job-info-row .value {
            color: #222;
            font-weight: 400;
        }

        /* 액션 버튼 영역 */
        .job-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            min-width: 230px;
            margin-left: 20px;
        }
        .btn-applicants {
            width: 230px;
            height: 50px;
            background-color: #255EB8;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #fff;
            font-weight: 500;
            border: none;
            cursor: pointer;
            text-decoration: none;
            margin-bottom: 10px;
        }
        .btn-applicants:hover {
            background-color: #326ac1;
        }
        .job-deadline {
            font-size: 18px;
            color: #000;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .job-deadline .th {
            font-weight: 600;
            margin-right: 10px;
        }
        .job-deadline .td {
            font-weight: 400;
            color: #222;
        }
        .btn-close {
            width: 230px;
            height: 50px;
            background-color: #a3a3a3;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #fff;
            font-weight: 500;
            border: none;
            cursor: pointer;
        }
        .btn-close:hover {
            background-color: #888;
        }
        .btn-close.closed {
            background: #888;
            cursor: default;
        }

        /* 페이지네이션 */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 40px;
        }
        .pagination a, .pagination span {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 37px;
            height: 37px;
            padding: 0 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 18px;
            color: #333;
            font-weight: 500;
            text-decoration: none;
        }
        .pagination span.active {
            border-color: #ccc;
            color: #255EB8;
        }

        /* 등록 버튼 */
        .btn-register-wrap {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .btn-register {
            width: 230px;
            height: 50px;
            background-color: #255EB8;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #fff;
            font-weight: 700;
            text-decoration: none;
        }
        .btn-register:hover {
            background-color: #4773b7;
        }

        /* 데이터 없음 */
        .no-data {
            text-align: center;
            padding: 80px 0;
            color: #888;
            font-size: 18px;
        }
    </style>
</head>

<body>
<div class="wrapper">

    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <main class="mypage-container">
        <!-- 탭 메뉴 -->
        <div class="tab-menu">
            <a href="/company/mypage">회원정보관리</a>
            <a href="/company/jobs" class="active">채용공고관리</a>
        </div>

        <!-- 지원현황 헤더 + 검색 -->
        <div class="section-header">
            <div class="section-title">지원현황</div>
            <div class="search-area">
                <select id="searchType">
                    <option value="">전체</option>
                    <option value="title">공고제목</option>
                    <option value="position">직종</option>
                </select>
                <div class="search-input">
                    <input type="text" id="searchKeyword" placeholder="검색어">
                    <button onclick="searchJobs()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                    </button>
                </div>
                <select id="statusFilter" onchange="filterByStatus()">
                    <option value="">전체</option>
                    <option value="active">진행중</option>
                    <option value="closed">마감</option>
                </select>
            </div>
        </div>

        <!-- 공고 목록 -->
        <div class="job-list" id="jobList">
            <div class="no-data">등록된 채용공고가 없습니다.</div>
        </div>

        <!-- 페이지네이션 -->
        <div class="pagination" id="pagination">
            <span class="active">1</span>
        </div>

        <!-- 등록 버튼 -->
        <div class="btn-register-wrap">
            <a href="/company/jobs/register" class="btn-register">등록하기</a>
        </div>
    </main>

    <div th:replace="~{fragments/footer :: footer}"></div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        checkSession();
        loadJobList();
    });

    async function checkSession() {
        try {
            const response = await fetch('/api/company/check-session');
            const data = await response.json();
            if (!data.loggedIn) {
                window.location.href = '/company/login';
            }
        } catch (error) {
            console.error('세션 확인 실패:', error);
        }
    }

    async function loadJobList() {
        // TODO: 실제 API 연동 시 아래 주석 해제
        /*
        try {
            const response = await fetch('/api/company/jobs');
            const data = await response.json();

            if (data.success && data.jobs && data.jobs.length > 0) {
                renderJobList(data.jobs);
            } else {
                document.getElementById('jobList').innerHTML = '<div class="no-data">등록된 채용공고가 없습니다.</div>';
            }
        } catch (error) {
            console.error('공고 목록 로드 실패:', error);
            document.getElementById('jobList').innerHTML = '<div class="no-data">등록된 채용공고가 없습니다.</div>';
        }
        */
    }

    function renderJobList(jobs) {
        const container = document.getElementById('jobList');

        if (!jobs || jobs.length === 0) {
            container.innerHTML = '<div class="no-data">등록된 채용공고가 없습니다.</div>';
            return;
        }

        let html = '';
        jobs.forEach(job => {
            html += `
                <div class="job-item">
                    <div class="job-logo">
                        <img src="${job.logoUrl || '/img/common/default_logo.png'}" alt="${job.companyName}">
                    </div>
                    <div class="job-content">
                        <div class="job-title">${job.title}</div>
                        <div class="job-info-table">
                            <div class="job-info-row">
                                <span class="label">직업유형</span>
                                <span class="value">${job.jobType || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">고용형태</span>
                                <span class="value">${job.employmentType || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">직종</span>
                                <span class="value">${job.position || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">업계</span>
                                <span class="value">${job.industry || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">직급</span>
                                <span class="value">${job.level || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">경력</span>
                                <span class="value">${job.experience || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">기본급</span>
                                <span class="value">${job.salary || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">근무시간</span>
                                <span class="value">${job.workHours || '-'}</span>
                            </div>
                            <div class="job-info-row">
                                <span class="label">근무처</span>
                                <span class="value">${job.location || '-'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="job-actions">
                        <a href="/company/jobs/${job.id}/applicants" class="btn-applicants">지원자 보기</a>
                        <div class="job-deadline">
                            <span class="th">마감일</span>
                            <span class="td">${job.deadline || '-'}</span>
                        </div>
                        <button class="btn-close ${job.status === 'closed' ? 'closed' : ''}"
                                onclick="${job.status === 'closed' ? '' : `closeJob(${job.id})`}"
                                ${job.status === 'closed' ? 'disabled' : ''}>
                            ${job.status === 'closed' ? '마감완료' : '공고마감'}
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    function searchJobs() {
        const keyword = document.getElementById('searchKeyword').value;
        const type = document.getElementById('searchType').value;
        console.log('검색:', type, keyword);
        // TODO: 검색 API 호출
    }

    function filterByStatus() {
        const status = document.getElementById('statusFilter').value;
        console.log('필터:', status);
        // TODO: 필터링 API 호출
    }

    async function closeJob(jobId) {
        if (!confirm('이 공고를 마감하시겠습니까?')) return;

        // TODO: 공고 마감 API 호출
        /*
        try {
            const response = await fetch(`/api/company/jobs/${jobId}/close`, {
                method: 'PUT'
            });
            const data = await response.json();
            if (data.success) {
                alert('공고가 마감되었습니다.');
                loadJobList();
            }
        } catch (error) {
            alert('공고 마감 중 오류가 발생했습니다.');
        }
        */
    }

    async function logout() {
        try {
            await fetch('/api/company/logout', { method: 'POST' });
            window.location.href = '/';
        } catch (error) {
            window.location.href = '/';
        }
    }
</script>

<script src="/js/common.js?v=1"></script>
</body>
</html>